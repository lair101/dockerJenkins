<!DOCTYPE html><!-- LOGIN_PAGE_EYECATCHER -->
<!--
    <copyright 
    notice="oco-source" 
    pids="5725-C18" 
    years="2015" 
    crc="2104174454" > 
    IBM Confidential 
     
    OCO Source Materials 
     
    5725-C18 
     
    (C) Copyright IBM Corp. 2015 
     
    The source code for the program is not published 
    or otherwise divested of its trade secrets, 
    irrespective of what has been deposited with the 
    U.S. Copyright Office. 
    </copyright> 
 -->
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Force no compatibility modes for IE. Not HTML5 compliant! -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">

    <META HTTP-EQUIV="PRAGMA" CONTENT="NO-CACHE">
    <META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">

    <link rel="stylesheet" type="text/css" href="webui/css/Main.css">
    <link rel="stylesheet" type="text/css" href="healthcare/css/Main.css">

    <!-- @import "login/css/login.css"; -->

    <script type="text/javascript">
      var dojoConfig = {
        parseOnLoad: false,
        async: true // Seems to help produce better error messages?
        //isDebug: true, // might improve debugging, allows a firebug plugin for IE8
        //useDeferredInstrumentation: true,
      };
    </script>

    <script src="dojo/dojo.js" type="text/javascript"></script>
    <script>
      require(["healthcare/main", "webui/main", "idx/main"], function() {
        // Define our main code here, as then it runs only after layers has been loaded.
        // Otherwise the optimised site tries to run before we have loaded all our js modules
        require( [
          'dojo/i18n!webui/nls/web',
          'dojo/i18n!healthcare/nls/web',
          'dojo/domReady!',
          'dojo/request',
          'dojo/dom-class',

          'idx/app/LoginFrame',
        ], function(
          NLS,
          PackNLS,
          ready,
          request,
          domClass,

          LoginFrame
        ) {
          document.title = PackNLS.title;

          var login;

          function doSubmission(username, password){
              // For some stupid reason we sometimes get called without the username field being set, despite the user having entered
              // it. Try and catch that and similar for password and read the field programatically
              if(!username){
                  username = login.loginUserName.getValue();
              }
              if(!password){
                  password = login.loginPassword.getValue();
              }
              //clear any failure messages (shouldn't need to worry about them not being set yet')
              login.set("loginSubTitle", NLS.loginInstruction);
              domClass.remove(login.loginSubtitleNode, 'failedLoginSubtitle');
              request('j_security_check',
                        {'method':'POST', 'data':{'j_username':username, 'j_password':password, 'action':'login'}}
                ).then(function(response){
                    if(response.indexOf("LOGIN_PAGE_EYECATCHER") >= 0){
                        // looks like we got the login page back - which means we failed to login
                        login.loginPassword.reset();
                        login.set("loginSubTitle", NLS.failedLogin);
                        domClass.add(login.loginSubtitleNode, 'failedLoginSubtitle');
                    }else{
                        //success. Now redirect to where we originally had tried to go to
                        window.location.reload(true);
                    }
              }, function(error){
                  console.error(error);
              });

            //on failure, display something
          }

          login = new LoginFrame({
            onSubmit:doSubmission,
            loginTitle: PackNLS.title,
            loginSubTitle: NLS.loginInstruction,
            //inactivityMessage:...
            loginCopyright:PackNLS.legalText,
            passwordAutoComplete: true,
            userAutoComplete: true,
          }, "login");
          login.startup();
          login.loginUserName.focus();
        });
      });
    </script>

  <!-- NLS: will be overwritten from NLS by script, but set a default one too -->
  <title>IBM Integration Bus Healthcare Pack</title>
  </head>
  <body class="oneui" id="main">
    <div id="login"> </div>
  </body>
</html>
