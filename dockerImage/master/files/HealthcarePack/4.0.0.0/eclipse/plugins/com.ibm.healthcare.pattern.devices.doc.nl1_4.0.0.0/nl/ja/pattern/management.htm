<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja-jp" xml:lang="ja-jp">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="copyright" content="Copyright IBM Corporation 2011, 2014"/>
    <link rel="stylesheet" type="text/css" href="./css/pattern.css"/>
    <!-- 
        (C) COPYRIGHT International Business Machines Corporation., 2011, 2014
        All Rights Reserved * Licensed Materials - Property of IBM
    --> <title>「Healthcare: Medical devices to EMR」パターン・インスタンスの管理</title>
</head>
<body role="main">
<a name="links"></a> <h1 class="topictitle1">「Healthcare: Medical devices to EMR」パターン・インスタンスの管理</h1>
<p>
ここでのパターンは、すべてのメッセージ・フローが単一の Integration ノードで実行される、単純なトポロジーであることを前提としています。
この単純なトポロジーを使用するパターン・インスタンスのデプロイおよび管理に関する情報と、パターン・インスタンスを管理する方法について、このトピックで説明します。
</p>
<p>
このトピックには、以下のセクションが含まれています。
    </p>
<div>
    <a href="management.htm#setup">セットアップ</a>
</div>
<div>
    <a href="management.htm#deployment">パターンのデプロイメント</a>
</div>
<div>
    <a href="management.htm#errors">モニターおよびエラー処理</a>
</div>
<div class="section">
    <a name="setup"></a> <h2 class="sectiontitle">セットアップ</h2> <h4>キュー</h4>
    <p>
パターンが必要とするキューを定義するために MQSC スクリプトを生成することにした場合は、パターン・インスタンスを生成する前に、<span class="uicontrol">「パターン・パラメーターの構成」</span>タブの<span class="uicontrol">「一般」</span>セクションにある<span class="msobjpropval">「スクリプトの生成」</span>チェック・ボックスを選択してください。
<tt>queues.mqsc</tt> というこのスクリプトは、パターン・インスタンス・プロジェクトのルート・ディレクトリーにあります。
これは、基本的なキューおよびトピックを定義します。
</p>
    <p>
MQSC スクリプトを実行するには、以下のコマンドを使用します。
ここで、<var>MBQMGR</var> は、Integration ノードのキュー・マネージャーの名前です。
</p>
    <pre>runmqsc <var>MBQMGR</var> &lt; queues.mqsc</pre>
    <p>
この MQSC スクリプトを編集すれば、使用している環境の説明を追加し、適切なキュー項目数を設定できます。
その他のキューもモニターして定期的にクリアすることをお勧めします。
これらのキューはデフォルトのサイズで作成されますが、その使用を検討して、項目数が十分であることを確認する必要があります。
</p>
    <p>
パターン・インスタンスをデプロイする前に、MQSC スクリプトを実行する必要があります。
</p>
</div>
<div class="section">
    <a name="deployment"></a> <h2 class="sectiontitle">パターンのデプロイメント</h2>
    <p>
新規 BAR ファイルを、そのリソースを保管する場所に作成します。
</p>
    <p>
HL7v25P メッセージ・セットを、それ専用の BAR ファイルにパッケージする必要があります。
</p>
    <ol>
        <li>
HL7v25P メッセージ・セットを選択し、BAR ファイルをビルドします。
</li>
        <li>
パターンまたはパターンの一部分を実行するすべての統合サーバーに BAR ファイルをデプロイします。
</li>
        <li>
HL7v25P メッセージ・セットのデプロイ後、必要なすべてのキューが定義されていることと、すべての構成可能サービス・ファイルがデプロイされていることを確認します。
</li>
        <li>
特定の統合サーバーにデプロイするフローが入った、1 つ以上の BAR ファイルを作成します。
単一のランタイム環境ですべてが実行される最も単純なケースでは、Receiver フローと Processor フローを組み込みます。
</li>
    </ol>
    <p>
    </p>
</div>
<div class="section">
    <a name="errors"></a> <h2 class="sectiontitle">モニターおよびエラー処理</h2>
    <p>
エラー通知は、パターン内のすべてのメッセージ・フローのエラー・キューに書き込まれます。
またキュー・トレースも、パターンの生成時に定義した場所に出力されます。
エラー・メッセージの MQRFH2 ヘッダーに、エラーが発生した場所を示す情報が含まれています。
各メッセージ・フローの動作に関する詳細を、このセクションで説明します。
</p>
    <h3>医療デバイス・フローでのエラー</h3>
    <p>
医療デバイス・フローはトランザクションとして実行され、メッセージ・フローが正常に完了するとすべての出力メッセージがコミットされます。
</p>
    <p>
エラーがある場合は、以下のイベントが発生します。
    </p>
    <ul>
        <li>
エラーは、MedicalDevicesExceptionHandler サブフローによってキャッチされ、処理されます。
このサブフローでは、MQMD ヘッダーと MQRFH2 ヘッダーがメッセージに追加され、トランザクション外のエラー・キューにメッセージが書き込まれます。
MQRFH2 ヘッダーには、エラーの発生場所の詳細が含まれます。エラー・メッセージの本文には、デバイス測定が含まれます。
</li>
        <li>
例外がスローされ、すべてのメッセージがロールバックされます。
また、ロールバックがトリガーとなって、例外情報がイベント・ログに出力されます。
</li>
        <li>
例外によって MedicalDeviceInput ノードにロールバックされると、デバイス測定が破棄されます。
</li>
    </ul>
    <p>
管理者はエラー・キューとイベント・ログをモニターして、メッセージがパターン・インスタンスによって処理されなかった時点を特定し、必要な修復処置を講じてそのエラーを解決する必要があります。
</p>
    <h3>変換および経路指定フローでのエラー</h3>
    <p>
変換および経路指定フローは、単一トランザクションとして実行されます。
メッセージ・フローが正常に完了すると、すべての出力メッセージが以下の場所にコミットされます。
</p>
    <ul>
        <li>
各宛先に対する送信側フローの入力キュー</li>
        <li>
正規メッセージ・フィードのキュー</li>
    </ul>
    <p>
エラーがある場合は、以下のイベントが発生します。
    </p>
    <ul>
        <li>
エラーは、TransformAndRouteExceptionHandler サブフローによってキャッチされ、処理されます。
このサブフローでは、MQRFH2 ヘッダーがメッセージに追加され、トランザクション外のエラー・キューにメッセージが書き込まれます。
MQRFH2 ヘッダーには、エラーの発生場所の詳細が含まれます。</li>
        <li>
例外がスローされ、入力メッセージがキューに戻され、キューに書き込まれたすべてのメッセージがロールバックされ、イベント・ログへの例外情報の出力がトリガーされます。
</li>
    </ul>
    <p>
    </p>
    <p>
管理者は、エラー・キューとイベント・ログを確認して、どんなエラーが発生したのかを判別する必要があります。
エラー・キューとバックアウト・キューの両方に情報が入れられますが、修正済みのメッセージが処理された後に、キューがいっぱいにならないようにこの情報をクリアする必要があります。
</p>
    <p>
管理者は、入力キューのためのバックアウト・キューを構成する必要があります。
</p>
    <h3>送信側フローでのエラー</h3>
    <p>
トランザクション外のエラー・キューにメッセージが書き込まれ、送信側フローの入力キューに入力メッセージがロールバックされます。
</p>
    <p>
入力キューは、バックアウト・キュー付きで構成する必要があります。
</p>
    <p>
さらに、メッセージが送達された後にエラーが起こることもあります。
このタイプのエラーは、宛先アプリケーションがメッセージを処理できず、NACK (否定応答) を送信した場合に発生します。
この場合、エラー・キューにメッセージが書き込まれます。
管理者は、エラー・メッセージを確認して、宛先アプリケーションで問題を修正する必要があります。
</p>
</div>
<a href="overview.htm#anchorBack" title="戻る">「Healthcare: Medical devices to EMR」パターンの仕様に戻る</a>
<p>
</p>
</body>
</html>
