<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja-jp" xml:lang="ja-jp">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="copyright" content="Copyright IBM Corporation 2011, 2014"/>
    <link rel="stylesheet" type="text/css" href="./css/pattern.css"/>
    <!-- 
        (C) COPYRIGHT International Business Machines Corporation., 2011, 2014
        All Rights Reserved * Licensed Materials - Property of IBM
    --> <title>「Healthcare: HL7 to reports」パターン・インスタンスのカスタマイズ</title>
</head>
<body role="main">
<a name="links"></a> <h1 class="topictitle1">「Healthcare: Medical devices to EMR」パターン・インスタンスのカスタマイズ</h1>
<div class="section">
    <a name="customize"></a> <h2 class="sectiontitle">カスタマイズ・サブフロー</h2>
    <p>
パターンのユーザーは、10 個の主要なカスタマイズ・ポイントを使用することができます。
これらのサブフローは、デバイス・メッセージが MedicalDeviceInput ノードによって伝搬され、HL7 に変換され、EMR に送信されるにつれて、さまざまな処理のステージで呼び出されます。
最もよく必要とされるのは HL7 検査結果メッセージのカスタマイズであり、これを実行する最良の方法は <tt>OnDestination</tt> サブフローを変更することです。
</p>
    <h3>医療デバイス・フロー</h3> 
    <div class="image">
        <img src="devices.png" alt="医療デバイス・フローを示す図" />
</div>
    <h4>状況のカスタマイズ</h4>
    <p>
<tt>OnStatus</tt> サブフローは、状況メッセージが MedicalDeviceInput ノードから伝搬されたときに呼び出されます。
状況メッセージには、デバイス状況情報、警告、およびエラーが含まれます。
エラー・メッセージの例として、MedicalDeviceInput ノードによって、医療デバイスへの接続不可について報告されることがあります。
このサブフローの一般的な使用法は、医療デバイスからエラー状態が報告された場合にアラートを送信することです。
</p>
    <h3>変換および経路指定フロー</h3> 
    <div class="image">
        <img src="transform.png" alt="変換および経路指定フローを示す図" /></div>
    <h4>無効な測定のカスタマイズ</h4>
    <p>
<tt>OnInvalid</tt> サブフローは、デバイス測定が、<span class="msobjpropval">CM_VALID</span> 以外の有効性で伝搬された場合に呼び出されます。
デバイス・メッセージ内の有効性エレメントによって、医療デバイスの測定に信頼度が付与されます。
当該パターンでは、有効なデバイス・メッセージのみを変換して送信します。
</p>
    <h4>一致なしのカスタマイズ</h4>
    <p>
<tt>OnNoMatch</tt> サブフローは、患者 ID がないデバイス・メッセージが処理されるときに呼び出されます。
このサブフローは、<span class="msobjprop">「患者 ID」</span>パターン・パラメーターが、<span class="msobjpropval">「観察結果に患者 ID がありません」</span>以外のものに設定された場合のみ呼び出されます。患者 ID が関連付けられないデバイス・メッセージがあることは、必ずしもエラー状態ではありません。
例えば、デバイスがスイッチの入ったままでデバイス・メッセージを生成し続けていても、データベースからの患者の関連付けが切断されている可能性があります。
</p>
    <h4>測定のカスタマイズ</h4>
    <p>
<tt>OnMeasure</tt> サブフローは、MedicalDeviceInput ノードによって伝搬されるデバイス測定ごとに呼び出されます。
このサブフローは、デバイス・メッセージが HL7 に変換される前に呼び出されるため、MedicalDeviceInput ノードからの未変更の測定が入っています。
このサブフローの使用法の 1 つは、メッセージ内の <span class="msobjprop">PrimaryId</span> が、EMR 用の適正なコード (LOINC コードなど) になるように調整することです。
</p>
    <h3>送信側フロー</h3> 
    <div class="image">
        <img src="sender.png" alt="送信側フローを示す図" /></div>
    <h4>宛先でのカスタマイズ</h4>
    <p>
<tt>OnDestination</tt> サブフローは、デバイス・メッセージが HL7 に変換された後に呼び出されます。
このサブフローの呼び出し後、メッセージは、EMR への送信の準備ができている宛先キューに書き込まれます。
一般にこのサブフローは、任意のサイト固有のメッセージ要件に合わせて HL7 検査結果メッセージをカスタマイズするために使用します。
</p>
    <h4>有効期限切れのカスタマイズ</h4>
    <p>
<span class="msobjprop">「有効期限」</span>パターン・パラメーターにより、古いメッセージが EMR に送信されないようにします。
有効期限の検査は、変換済みの HL7 メッセージが宛先アプリケーションに送信される直前に実行されます。
有効期限が切れたメッセージは、有効期限切れキューに書き込まれ、破棄されます。
このサブフローは、有効期限切れキューへの書き込み前に、変換済みの HL7 メッセージとともに呼び出されます。
</p>
    <h4>完了のカスタマイズ</h4>
    <p>
<tt>OnFinished</tt> サブフローは、変換済みの HL7 メッセージが送信され、宛先アプリケーションによる応答が行われた後に呼び出されます。
</p>
    <h4>送信側のカスタマイズ</h4>
    <p>
<tt>OnSend</tt> サブフローは、変換済みの HL7 メッセージが宛先 HL7 アプリケーションに送信される前に呼び出されます。
このサブフローは、EMR への HL7 メッセージの送信前に、最終の変更を行う機会となります。
</p>
    <h3>Web サービス・フロー</h3> 
    <div class="image">
        <img src="service.png" alt="Web サービス・フローを示す図" /></div>
    <h4>サービスのカスタマイズ</h4>
    <p>
当該パターンでは、患者 ID データベースを管理するための Web サービスが提供されます。
<tt>OnService</tt> サブフローは、この Web サービスに対する要求ごとに呼び出されます。
</p>
    <h3>エラー処理</h3> 
    <p>
当該パターン内のメイン・フローごとに、独自のエラー処理サブフローが存在します。
エラー・メッセージは、当該パターン全体にわたって共通のエラー・キューに書き込まれます。</p>
    <h4>エラーのカスタマイズ</h4>
    <p>
<tt>OnErrorQueue</tt> は、エラーが検出され、エラー・メッセージがエラー・キューに書き込まれると呼び出されます。
デフォルトのカスタマイズ・サブフローではメッセージに対する影響はありませんが、このサブフローを利用して、ご使用の環境で要求される仕様に合致したエラー・メッセージを作成することが可能です。
</p>
</div>
<a href="overview.htm#anchorBack" title="戻る">「Healthcare: Medical devices to EMR」パターンの仕様に戻る</a>
<p>
</p>
</body>
</html>
