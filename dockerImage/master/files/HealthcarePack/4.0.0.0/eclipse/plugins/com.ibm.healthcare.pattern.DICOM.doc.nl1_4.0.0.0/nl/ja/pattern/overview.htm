<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="copyright" content="Copyright IBM Corporation 2013, 2014"/>
    <link rel="stylesheet" type="text/css" href="./css/pattern.css"/>
    <!-- 
    (C) COPYRIGHT International Business Machines Corp., 2013, 2014
    All Rights Reserved * Licensed Materials - Property of IBM
    --> 
    <title>「Healthcare: Web service to DICOM」パターン</title>
</head>
<body role="main">
<h1 class="topictitle1">「Healthcare: Web service to DICOM」パターン</h1>
<p>
<span>「Healthcare: Web service to DICOM」</span>パターンを使用して、Web サービスを使って作成したアプリケーションを、C-FIND 操作および C-MOVE 操作をサポートする DICOM アプリケーションと統合します。
パターンを使用することにより、IBM Integration Bus によって実装された Web サービスを使用して、DICOM アーカイブ (PACS) から患者、研究、系統、およびイメージを照会することができます。
</p>
<div class="image">
    <img src="DICOM.png" alt="「Healthcare: Web service to DICOM」パターンの動作を示す図"/>
</div>
<h2>ソリューション</h2>
<p>
「<span>Healthcare: Web service to DICOM</span>」パターンのインスタンスは、PACS の DICOM 接続の詳細によって構成されます。
接続情報には、PACS のホスト名とポートが含まれています。
DICOM アプリケーションは、その接続時に自らを識別します。
そのため、パターンを、IBM Integration Toolkit パターン・インスタンスのアプリケーション・エンティティー・タイトル (AET) および PACS で構成します。
</p>
<p>
「<span>Healthcare: Web service to DICOM</span>」パターンは、PACS との対話に DICOMFindMove ノードを使用します。
DICOMFindMove ノードには、密接に関連した 2 つの機能があります。
1 つ目は、PACS を照会して患者、研究、系統、およびイメージを探す機能です。
検索基準は、ノードの入力ターミナルに伝搬される XML メッセージに指定されます。
DICOM 照会の結果は、ノードの出力ターミナルから伝搬されます。
</p>
<p>
DICOMFindMove ノードのもう 1 つの機能は、C-MOVE コマンドを使って照会の結果を DICOM アプリケーションに移動する機能です。
C-MOVE コマンドの宛先として、IBM Integration Bus で構成した DICOMInput ノードを指定することもできます。
これにより、非常に柔軟性のあるルーティング・トポロジーを構成できるようになります。
C-MOVE コマンドの宛先は、XML メッセージ内のアプリケーション・エンティティー・タイトル (AET) として指定されます。
PACS を C-MOVE 宛先で事前に構成し、DICOM オブジェクト・インスタンスの送信先が分かるようにしておく必要があります。
</p>
<p>
要求元アプリケーションは、検索基準を SOAP 要求メッセージの XML 本体として送信します。
「Healthcare: Web service to DICOM」パターン・インスタンスによって生成されるメイン・メッセージ・フローは、その本体を抽出し、DICOMFindMove ノードに渡します。
DICOMFindMove ノードによって伝搬される XML の結果は、SOAP 応答で要求元アプリケーションに送り返されます。
</p>
<p>
C-FIND コマンドまたは C-MOVE コマンドの実行中にエラーが発生した場合、メッセージ・フローは例外をスローします。
例外リストには、問題を説明する挿入が入ります。
パターンは、エラー・キューに基づくオプションのエラー処理を提供します。
エラー処理が有効になっており、例外がスローされる場合、エラーはエラー・キューに記録され、エラー HTTP 応答メッセージが要求元アプリケーションに送り返されます。
</p>
<h5>照会ルート</h5>
<p>
DICOM は、照会ルートと呼ばれるいくつかのタイプの C-FIND 照会を定義します。
DICOMFindMove ノードによってサポートされているルートは、患者と研究です。
その他にもいくつかの照会ルートがありますが、それらは DICOM 標準で廃止されています。
</p>
<p>
患者ルートでは、患者、研究、系統、およびイメージの 4 つのレベルの照会が可能です。
患者レベルの照会は、PACS を照会して患者を探すために使用されます。
これには、照会で使用できる少数の暗黙的属性があります。
例えば、患者名や患者の性別、誕生日などです。
研究レベルの照会は、PACS を照会して特定の患者の研究を探すために使用されます。
研究レベルの照会には、患者 ID 属性と、検索を絞り込むためのゼロ個以上のオプション属性 (研究の日付など) を含める必要があります。
系統レベルの照会は、PACS を照会して特定の研究内の系統を探すために使用されます。
系統レベルの照会には、研究 UID と、検索を絞り込むためのゼロ個以上のオプション属性 (モダリティーなど) を含める必要があります。
最後に、イメージ・レベルの照会は、系統内の特定のイメージを照会するために使用されます。
これはほとんど使用されません。
イメージ・レベルの照会には、系統 UID を含める必要があります。
</p>
<p>
研究ルートは患者ルートと似ています。そのため、しばしば混乱が生じることがあります。
研究ルートには患者レベルの照会がありません。
サポートされている最初のレベルは、研究レベルの照会です。
この照会には、使用可能な暗黙的属性のセットがより多くあります。
サポートされている属性として、研究日や研究時刻、また患者の属性 (患者名や患者 ID、患者の性別など) もあります。
そのため、この研究レベルの照会は、患者ルートからの研究レベルと患者レベルの照会のマージと見なすことができます。
いくつかの基本検索基準 (患者名や研究日) を指定すれば、1 回の操作で患者のすべての研究を照会できるため、研究レベルの照会は非常に便利です。
系列レベルとイメージ・レベルの照会は、研究ルートと患者ルートで同一です。
</p>
<p>
DICOMFindMove ノードは、2 つのルートと、上述の 7 つの照会レベル (4 つは患者ルートにあり、3 つは研究ルートにある) をサポートしています。
ルートとレベルの組み合わせごとに、ノードは、サポートされる検索属性と、PACS によって返される属性の最小セットを定義します。
なお、照会によって多数の結果メッセージが返される可能性がありますが、これらは単一メッセージとして DICOMFindMove ノードから伝搬されるため、単一 XML メッセージとして SOAP 応答で返されます。
</p>
<p>
ベンダーは、XML 照会メッセージで検索基準として使用したり、結果メッセージで返したりすることができる追加属性をサポートすることができます。
ノードではこれらを XML 照会メッセージ内に構成できますが、これらはベンダーに固有であるため、「Healthcare: Web service to DICOM」パターンに記載されていません。
DICOM では、検索基準に指定されるすべての検索属性が応答でも返されるようにする必要があります。
</p>
<h5>生成される Web サービス</h5>
<p>
パターン・インスタンスは、Web サービスを実装するメッセージ・フローを生成します。パターン・インスタンスは、要求元アプリケーションと IBM Integration Bus との間の Web サービス・インターフェースを表す WSDL ファイルも生成します。
</p>
<p>
パターン・インスタンスによって生成される WSDL ファイルは、生成されるメッセージ・フロー内の SOAPInput ノードを構成します。
WSDL ファイルを使用して、要求元アプリケーションが、確実に正しい形式で SOAP 要求を送受信するようにできます。</p>
<p>
WSDL ファイルは、WS-I 準拠の Web サービス記述です。
WSDL ファイルには、WSDL ポート・タイプ定義と、C-FIND 要求および C-MOVE 要求を送信するための単一操作が含まれます。
操作には、入力メッセージと出力メッセージがあります。
要求メッセージは 2 つの照会ルートの 7 つの異なるタイプの照会メッセージをサポートするので、高い柔軟性があります。
パターン・インスタンスは、XML スキーマ・ファイルも生成します。XML スキーマは、要求メッセージおよび応答メッセージのデータ・タイプを表します。
このスキーマ・ファイルは、標準的な WSDL <code>include</code> ステートメントを使用して WSDL ファイルに組み込まれます。</p>
<h5>Web サービスのデプロイ</h5>
<p>
WSDL とスキーマは両方とも、生成されるメッセージ・フローと一緒に IBM Integration Bus にデプロイしなければなりません。
WebSphere Message Broker バージョン 8.0 以降、WSDL ファイルと XML スキーマ・ファイルを、Integration ノードにデプロイする前にメッセージ・セットにインポートする必要がなくなりました。

WSDL およびスキーマは、IBM Integration Toolkit によって自動的に BAR ファイルにパッケージ化されます。
</p>
<div>
    <div class="familylinks">
        <a name="anchor"></a>
        <div class="section">
            <h2 class="sectiontitle">関連タスク</h2>
        </div>
        <p>
このパターンの適用と使用の方法については、以下のセクションをお読みください。</p>
    </div>
    <div>
        			<a href="constraints.htm" title="パターンの使用に関する制約">パターンの使用に関する制約</a>
</div>
    <div>
        <a href="before.htm" title="パターンを使用する前に知っておくべき事柄や、必要なリソースについての詳細。">パターンを適用する前に完了するタスク</a></div>
    <div>
        		<a href="parameters.htm" title="パターンのパラメーター">パターンのパラメーター</a>
</div>
    <div>
        <a href="examples.htm" title="">C-FIND 要求および C-MOVE 要求のサンプル・メッセージ</a>
    </div>
    <div>
        <a href="after.htm" title="">パターンを生成した後に完了するタスク</a></div>
    <p>
    </p>
</div>
</body>
</html>
