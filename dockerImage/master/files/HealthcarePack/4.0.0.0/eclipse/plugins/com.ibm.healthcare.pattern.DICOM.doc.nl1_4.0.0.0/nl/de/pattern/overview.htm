<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="de" lang="de">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="copyright" content="Copyright IBM Corporation 2013, 2014"/>
    <link rel="stylesheet" type="text/css" href="./css/pattern.css"/>
    <!-- 
    (C) COPYRIGHT International Business Machines Corp., 2013, 2014
    All Rights Reserved * Licensed Materials - Property of IBM
    --> 
    <title>Muster 'Healthcare: Web-Service an DICOM'</title>
</head>
<body role="main">
<h1 class="topictitle1">Muster 'Healthcare: Web-Service an DICOM'</h1>
<p>
Das Muster <span>Healthcare: Web-Service an DICOM</span> integriert eine Anwendung, die mithilfe von Web-Services geschrieben wurde, in DICOM-Anwendungen, die C-FIND- und C-MOVE-Operationen unterstützen. Mit diesem Muster können mithilfe eines über IBM Integration Bus implementierten Web-Service Patienten, Untersuchungen, Serien und Bilder aus einem DICOM-Archiv (PACS) abgefragt werden.
</p>
<div class="image">
    <img src="DICOM.png" alt="Eine Abbildung, die das Verhalten des Musters 'Healthcare: Web-Service an DICOM' veranschaulicht."/>
</div>
<h2>Lösung</h2>
<p>
Eine Instanz des Musters <span>Healthcare: Web-Service an DICOM</span> wird mit den DICOM-Verbindungsdetails des PACS konfiguriert. Zu den Verbindungsinformationen gehören Hostname und Portnummer des PACS. DICOM-Anwendungen weisen sich beim Herstellen einer Verbindung aus, daher müssen Sie das Muster mit den Anwendungsinstanztiteln der IBM Integration Toolkit-Musterinstanz und des PACS konfigurieren.
</p>
<p>
Das Muster <span>Healthcare: Web-Service an DICOM</span> verwendet den DICOMFindMove-Knoten als Schnittstelle zum PACS. Dieser Knoten verfügt über zwei Leistungsmerkmale, die eng miteinander verknüpft sind. Zum einen ist es die Möglichkeit, Angaben zu Patienten, Untersuchungen, Serien und Bildern aus einem PACS abzufragen. Die Suchkriterien werden in einer XML-Nachricht angegeben, die an das Eingabeterminal des Knotens weitergegeben wird. Das Ergebnis der DICOM-Abfragen wird vom Ausgabeterminal des Knotens weitergegeben.
</p>
<p>
Das zweite Leistungsmerkmal des DICOMFindMove-Knotens ist die Möglichkeit, die Ergebnisse einer Abfrage mithilfe eines  C-MOVE-Befehls in eine DICOM-Anwendung zu verschieben. Bei dem Ziel eines C-MOVE-Befehls kann es sich um einen in IBM Integration Bus konfigurierten DICOMInput-Knoten handeln; dies erlaubt die Konfiguration hochflexibler Routingtopologien. Das Ziel des C-MOVE-Befehls wird in der XML-Nachricht in Form eines Anwendungsinstanztitels angegeben. 
Das Ziel für den C-MOVE-Befehl muss vorab im PACS konfiguriert werden, damit bekannt ist, wohin die DICOM-Objektinstanzen gesendet werden sollen.
</p>
<p>
Die anfordernde Anwendung sendet die Suchkriterien als XML-Hauptteil in der SOAP-Anforderungsnachricht. Der vom Muster 'Healthcare: Web-Service an DICOM' generierte Hauptnachrichtenfluss extrahiert diesen Hauptteil und gibt ihn an den DICOMFindMove-Knoten weiter. Die vom DICOMFindMove-Knoten weitergegebenen XML-Ergebnisse werden in einer SOAP-Antwort an die anfordernde Anwendung zurückgegeben.
</p>
<p>
Tritt bei der Ausführung eines C-FIND- oder C-MOVE-Befehls ein Fehler auf, wird vom Nachrichtenfluss eine Ausnahme  ausgegeben. Die Ausnahmeliste enthält Einfügungen, die das Problem erläutern. Das Muster stellt eine optionale Fehlerbehandlung auf Basis einer Fehlerwarteschlange bereit. Ist die Fehlerbehandlung aktiviert und wird eine Ausnahme ausgegeben, wird der Fehler in einer Fehlerwarteschlange aufgezeichnet und an die anfordernde Anwendung wird eine HTTP-Fehlerantwortnachricht zurückgesendet.
</p>
<h5>Abfragestämme</h5>
<p>
DICOM definiert mehrere C-FIND-Abfragetypen, die sogenannten Abfragestämme. Vom DICOMFindMove-Knoten werden der Patientenstamm und der Untersuchungsstamm unterstützt. Es gibt noch weitere Abfragestämme, die jedoch aus dem DICOM-Standard entfernt wurden.
</p>
<p>
Für den Patientenstamm sind vier Abfrageebenen möglich: Patient, Untersuchung, Serie und Bild. 
Mit der Abfrage auf Patientenebene werden Daten zu Patienten aus einem PACS abgefragt. Es stehen mehrere Attribute zur Verfügung, die in der Abfrage verwendet werden können, wie Name, Geschlecht und Geburtsdatum des Patienten. Mit der Abfrage auf Untersuchungsebene werden Angaben zu den Untersuchungen für einen bestimmten Patienten aus einem PACS abgefragt. Die Abfrage auf Untersuchungsebene muss das Attribut für die Patienten-ID und keine sonstigen Attribute enthalten. Optional kann die Suche mit weiteren Attributen eingegrenzt werden (zum Beispiel mit dem Attribut für das Untersuchungsdatum). Mit der Abfrage auf Serienebene werden Serien im Rahmen einer bestimmten Untersuchung aus einem PACS abgefragt. Die Abfrage auf Serienebene muss die Serien-UID enthalten; außerdem kann sie null oder mehrere optionale Attribute wie beispielsweise die Modalität enthalten, um die Suche weiter einzugrenzen. Mit der Abfrage auf Bildebene schließlich werden bestimmte Bilder in einer Serie abgefragt. Diese Abfrage wird nur selten verwendet. Eine Abfrage auf Bildebene muss die Serien-UID enthalten.
</p>
<p>
Der Untersuchungsstamm hat Ähnlichkeit mit dem Patientenstamm, was häufig Verwirrung stiftet. Innerhalb des Untersuchungsstamms gibt es keine Abfragen auf Patientenebene. Die Abfrage auf Untersuchungsebene ist die erste Ebene, die unterstützt wird. Für diese Abfrage steht eine größere Anzahl von Attributen zur Verfügung, die verwendet werden können. Unter anderem werden Attribute für das Datum und die Uhrzeit der Untersuchung unterstützt, sowie Patientenattribute wie beispielsweise Name, ID und Geschlecht des Patienten. Die Abfrage auf Untersuchungsebene kann daher auch als eine kombinierte Abfrage auf Untersuchungs- und Patientenebene im Kontext des Patientenstamms gesehen werden. Die Abfrage auf Untersuchungsebene ist sehr hilfreich, da Sie mit einigen grundlegenden Suchkriterien wie Name des Patienten und Datum der Untersuchung alle Untersuchungen eines Patienten abfragen können. 
Die Abfragen auf Zeitreihen- und Bildebene sind beim Untersuchungsstamm und Patientenstamm identisch.
</p>
<p>
Der DICOMFindMove-Knoten unterstützt die beiden Stämme und die oben beschriebenen sieben Abfrageebenen (vier im Rahmen des Patientenstamms, drei im Rahmen des Untersuchungsstamms). Für jede Kombination aus Stamm und Ebene definiert der Knoten die unterstützten Suchattribute und eine Mindestanzahl von Attributen, die vom PACS zurückgegeben werden. Von einer Abfrage können viele Ergebnisnachrichten zurückgegeben werden; diese werden vom DICOMFindMove-Knoten in Form einer einzigenNachricht weitergegeben und daher in der SOAP-Antwort als eine einzige XML-Nachricht zurückgegeben.
</p>
<p>
Anbieter unterstützen unter Umständen weitere Attribute, die in der XML-Abfragenachricht als Suchkriterien angegeben oder in den Ergebnisnachrichten zurückgegeben werden können. Der Knoten unterstützt die Konfiguration dieser Attribute in der XML-Abfragenachricht; da sie anbieterspezifisch sind, werden sie jedoch vom Muster 'Healthcare: Web-Service an DICOM' nicht dokumentiert. Der DICOM-Standard verlangt, dass alle in den Suchkriterien bereitgestellten Suchattribute auch in den Antworten zurückgegeben werden müssen.
</p>
<h5>Generierte Web-Services</h5>
<p>
Die Musterinstanz generiert Nachrichtenflüsse, mit denen ein Web-Service implementiert wird. Darüber hinaus wird vom Muster auch eine WSDL-Datei generiert, die die Web-Service-Schnittstelle zwischen einer anfordernden Anwendung und IBM Integration Bus darstellt.
</p>
<p>
Die von der Musterinstanz generierte WSDL-Datei konfiguriert den SOAPInput-Knoten in den generierten Nachrichtenflüssen. Außerdem können anfordernde Anwendungen mithilfe der WSDL-Dateien sicherstellen, dass SOAP-Anforderungen im korrekten Format gesendet und empfangen werden.
</p>
<p>
Bei der WSDL-Datei handelt es sich um eine WS-I-konforme Web-Service-Beschreibung. Die WSDL-Datei enthält eine WSDL-Porttypdefinition sowie eine einzige Operation zum Senden von C-FIND- und C-MOVE-Anforderungen. Die Operation verfügt über eine Eingabe- und eine Ausgabenachricht. 
Die Anforderungsnachricht ist sehr flexibel, da sie für die beiden Abfragestämme sieben unterschiedliche Abfragenachrichtentypen unterstützt. Darüber hinaus wird von der Musterinstanz eine XML-Schemadatei generiert, die zwei Datentypen für Anforderungs- und Antwortnachrichten darstellt. Die Schemadatei wird über die WSDL-Standardanweisung <code>include</code> in die WSDL-Datei eingefügt.
</p>
<h5>Web-Services implementieren</h5>
<p>
Die WSDL-Datei und die Schemadatei müssen zusammen mit den generierten Nachrichtenflüssen in IBM Integration Bus implementiert werden. Ab WebSphere Message Broker Version 8.0 müssen die WSDL-Datei und die XML-Schemadatei vor ihrer Implementierung in einem Integrationsknoten nicht mehr in eine Nachrichtengruppe importiert werden. Die WSDL-Datei und die Schemadatei werden von IBM Integration Toolkit automatisch in eine BAR-Datei gepackt.
</p>
<div>
    <div class="familylinks">
        <a name="anchor"></a>
        <div class="section">
            <h2 class="sectiontitle">Zugehörige Tasks</h2>
        </div>
        <p>
        In den folgenden Abschnitten finden Sie weitere Informationen zur Anwendung und Verwendung dieses Musters.
</p>
    </div>
    <div>
        <a href="constraints.htm" title="Bedingungen für die Verwendung des Musters.">Bedingungen für die Verwendung des Musters</a>
    </div>
    <div>
        <a href="before.htm" title="Wichtige Hinweise zur Verwendung des Musters und zu den Ressourcen, die Voraussetzung für die Verwendung des Musters sind.">Tasks, die vor der Anwendung des Musters 'Healthcare: Web-Service an DICOM' ausgeführt werden müssen</a>
    </div>
    <div>
        <a href="parameters.htm" title="Parameter für das Muster">Parameter für das Muster</a>
    </div>
    <div>
        <a href="examples.htm" title="">Beispielnachrichten für C-FIND- und C-MOVE-Anforderungen</a>
    </div>
    <div>
        <a href="after.htm" title="">Tasks, die nach der Erstellung des Musters auszuführen sind</a>
    </div>
    <p>
    </p>
</div>
</body>
</html>
