<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-us" xml:lang="en-us">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="copyright" content="Copyright IBM Corporation 2011, 2014"/>
    <link rel="stylesheet" type="text/css" href="./css/pattern.css"/>
    <!--
    (C) COPYRIGHT International Business Machines Corp., 2011, 2014
    All Rights Reserved * Licensed Materials - Property of IBM
    --> 
    <title>Design of the Healthcare: Medical devices to HL7 pattern</title>
</head>
<body role="main">
<a name="links"></a>
<div class="section">
    <h1 class="topictitle1">Design of the Healthcare: Medical devices to HL7 pattern</h1>
    <p class="shortdesc">
    This pattern uses the MedicalDeviceInput node to read measurements and alerts from 
    medical devices. The device readings are transformed into HL7 observation result 
    messages (ORU R01). The transformed messages are sent to a destination 
    application such as an Electronic Medical Record (EMR) using the HL7 MLLP 
    protocol.
    </p>
</div>
<div>
    <p>
    This topic contains the following sections:
    </p>
    <div>
        <a href="design.htm#devices">Medical Devices flow</a>
    </div>
    <div>
        <a href="design.htm#transform">Transform and Route flow</a>
    </div>
    <div>
        <a href="design.htm#sender">Sender flow</a>
    </div>
    <div>
        <a href="design.htm#service">Service flow</a>
    </div>
    <div>
        <a href="design.htm#results">Observation results</a>
    </div>
    <div>
        <a href="design.htm#output">Output from a pattern instance</a>
    </div>
</div>
<div class="section">
    <a name="devices"></a><h2>Medical Devices flow</h2>
    <p>
    The Medical Devices flow processes the messages from the MedicalDeviceInput node. Each 
    message has an expiry time added to it's MQRFH2 header. The messages are written 
    to a queue ready for the Transform and Route flow. After a message has been 
    written to the queue, a journal message is published for the device measurement.
    </p>
</div>
<div class="section">
    <a name="transform"></a><h2>Transform and Route flow</h2>
    <p>
    The Transform and Route flow converts a device message to an HL7 observation 
    result (ORU R01). The flow checks each device message to ensure it's measurement 
    is valid. Invalid measurements are written to a queue and discarded. If the 
    pattern is configured to lookup patient identifiers, the device identifier is 
    used as a key to a database table to obtain the patient identifier associated 
    with the device message. The transformed HL7 message is written to a no-match 
    queue for the Sender flow.
    </p>
</div>
<div class="section">
    <a name="sender"></a><h2>Sender flow</h2>
    <p>
    The Sender flow reads the HL7 messages from a queue and sends them to the 
    destination application using the HL7 MLLP protocol. The Sender flow retries a 
    configurable number of times if message delivery is disrupted. The Sender flow 
    checks the expiry time of the message. If the message has taken too long to be 
    processed, the message is written to an expired queue and then discarded.
    </p>
</div>
<div class="section">
    <a name="service"></a><h2>Service flow</h2>
    <p>
    The pattern can optionally created a web service interface to the patient 
    identifiers database. The interface is implemented using a message flow. Web 
    service requests are received using a SOAPInput node and routed to a Compute 
    node which performs the necessary database query or update. The flow requires a 
    WSDL message set to configure the SOAP nodes. This message set is provided in 
    the pattern resources topic.
    </p>
</div>
<div class="section">
    <a name="results"></a><h2>Observation results</h2>
    <p>
    The following tables show how the segments in an HL7 ORU R01 messages are 
    constructed:
    </p>
</div>
<div class="tablenoborder">
    <h4>MSH</h4>
    <p>
    The MSH segment defines the intent, source identifier, destination identifier, 
    and some specifics of the syntax of an HL7 message.
    </p>
    <table summary="" width="100%" border="1" cellpadding="4" cellspacing="0" frame="border" rules="all">
        <thead align="left">
        <tr>
            <th class="firstcol" align="left" valign="top" width="33%">Field name</th>
            <th class="invisible" valign="top" width="33%">Field value in observation result 
            message</th>
            <th class="invisible" valign="top" width="33%">Configured by pattern parameter</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">MSH.1.FieldSeparator</th>
            <td valign="top" width="*" class="invisible">
                <span class="msobjpropval">
                '|'
                </span>
            </td>
            <td></td>
        </tr>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">MSH.ServiceString</th>
            <td valign="top" width="*" class="invisible">
                <span class="msobjpropval">
                '^~\&amp;'
                </span>
            </td>
        </tr>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">MSH.3.SendingApplication</th>
            <td valign="top" width="*" class="invisible">'Message Broker'</td>
            <td valign="top" width="*" class="invisible">
                <span class="msobjprop">
                Source identifier
                </span>
            </td>
        </tr>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">MSH.4.SendingFacility</th>
            <td valign="top" width="*" class="invisible">''</td>
            <td valign="top" width="*" class="invisible">
                <span class="msobjprop">
                Source facility
                </span>
            </td>
        </tr>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">MSH.5.ReceivingApplication</th>
            <td valign="top" width="*" class="invisible">'EMR'</td>
            <td>
                <span class="msobjprop">
                Destination identity
                </span>
            </td>
        </tr>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">MSH.6.ReceivingFacility</th>
            <td valign="top" width="*" class="invisible">''</td>
            <td>
                <span class="msobjprop">
                Destination facility
                </span>
            </td>
        </tr>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">MSH.7.DateTimeOfMessage</th>
            <td valign="top" width="*" class="invisible">Copied from the time stamp in the 
            MedicalDeviceInput node message</td>
            <td valign="top" width="*" class="invisible"></td>
        </tr>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">MSH.9.MessageType</th>
            <td valign="top" width="*" class="invisible">
                <span class="msobjpropval">
                'ORU^R01^ORU_R01'
                </span>
            </td>
            <td valign="top" width="*" class="invisible"></td>
        </tr>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">MSH.10.MessageControlID</th>
            <td valign="top" width="*" class="invisible">UUID or current time stamp in 
            format yyyyMMddHHmmssSSSSSS</td>
            <td valign="top" width="*" class="invisible">
                <span class="msobjprop">
                Message identifiers
                </span>
            </td>
        </tr>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">MSH.11.ProcessingID</th>
            <td valign="top" width="*" class="invisible">
                <span class="msobjpropval">
                'P'
                </span>
            </td>
            <td valign="top" width="*" class="invisible"></td>
        </tr>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">MSH.12.VersionID</th>
            <td valign="top" width="*" class="invisible">
                <span class="msobjpropval">
                '2.5'
                </span>
            </td>
            <td valign="top" width="*" class="invisible"></td>
        </tr>
        </tbody>
    </table>
    <h4>PID</h4>
    <p>
    The PID segment is used by all applications as the primary means of 
    communicating patient identification information.  This segment contains 
    permanent patient identifying and demographic information that, for the most 
    part, is not likely to change frequently.
    </p>
    <table summary="" width="100%" border="1" cellpadding="4" cellspacing="0" frame="border" rules="all">
        <thead align="left">
        <tr>
            <th class="firstcol" align="left" valign="top" width="33%">Field name</th>
            <th class="invisible" valign="top" width="33%">Field value in observation result 
            message</th>
            <th class="invisible" valign="top" width="33%">Configured by pattern parameter</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">PID.3.PatientIdentifierList</th>
            <td valign="top" width="*" class="invisible">This field is determined by the
                <span class="msobjprop">
                Patient identifiers
                </span>
                pattern parameter.
                <p>
                The field is not valued if
                <span class="msobjpropval">
                No patient identifiers in observation results
                </span>
                is selected.
                </p>
                <p>
                The patient identifier from the message is copied to this field if
                <span class="msobjpropval">
                Use patient identifiers from device
                </span>
                .
                </p>
                <p>
                If
                <span class="msobjpropval">
                Lookup patient identifiers in database
                </span>
                is selected then the device identifier is used to lookup an associated patient 
                identifier in a database.
                </p>
            </td>
            <td valign="top" width="*" class="invisible">
                <span class="msobjprop">
                Patient identifiers
                </span>
            </td>
        </tr>
        </tbody>
    </table>
    <h4>PV1</h4>
    <p>
    The PV1 segment is used by patient administration applications to communicate 
    information on an account or visit-specific basis.
    </p>
    <table summary="" width="100%" border="1" cellpadding="4" cellspacing="0" frame="border" rules="all">
        <thead align="left">
        <tr>
            <th class="firstcol" align="left" valign="top" width="33%">Field name</th>
            <th class="invisible" valign="top" width="33%">Field value in observation result 
            message</th>
            <th class="invisible" valign="top" width="33%">Configured by pattern parameter</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">PV1.2.PatientClass</th>
            <td valign="top" width="*" class="invisible">'I'</td>
            <td valign="top" width="*" class="invisible">
                <span class="msobjprop">
                Patient class
                </span>
            </td>
        </tr>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">PV1.3.AssignedPatientLocation</th>
            <td valign="top" width="*" class="invisible">Location from the MedicalDeviceInput node 
            message</td>
            <td valign="top" width="*" class="invisible"></td>
        </tr>
        </tbody>
    </table>
    <h4>OBR</h4>
    <p>
    In the reporting of clinical data, the OBR serves as the result header.  It 
    identifies the observation set represented by the following atomic observations. 
    It includes the relevant ordering information when that applies. It contains 
    many of the attributes that usually apply to all of the included observations.
    </p>
    <table summary="" width="100%" border="1" cellpadding="4" cellspacing="0" frame="border" rules="all">
        <thead align="left">
        <tr>
            <th class="firstcol" align="left" valign="top" width="33%">Field name</th>
            <th class="invisible" valign="top" width="33%">Field value in observation result 
            message</th>
            <th class="invisible" valign="top" width="33%">Configured by pattern parameter</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">OBR.7.ObservationDateTime</th>
            <td valign="top" width="*" class="invisible">Same as
                <span class="msobjprop">
                MSH.7.DateTimeOfMessage
                </span>
            </td>
            <td valign="top" width="*" class="invisible"></td>
        </tr>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">OBR.10.CollectorIdentifier</th>
            <td valign="top" width="*" class="invisible">Same as
                <span class="msobjprop">
                PV1.3.AssignedPatientLocation
                </span>
            </td>
            <td valign="top" width="*" class="invisible"></td>
        </tr>
        </tbody>
    </table>
    <h4>OBX</h4>
    <p>
    The OBX segment is used to transmit a single observation or observation fragment. 
    It represents the smallest indivisible unit of a result.
    </p>
    <table summary="" width="100%" border="1" cellpadding="4" cellspacing="0" frame="border" rules="all">
        <thead align="left">
        <tr>
            <th class="firstcol" align="left" valign="top" width="33%">Field name</th>
            <th class="invisible" valign="top" width="33%">Field value in observation result 
            message</th>
            <th class="invisible" valign="top" width="33%">Configured by pattern parameter</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">OBX.1.SetIDOBX</th>
            <td valign="top" width="*" class="invisible">Numeric index of the OBX segment 
            starting with 1.</td>
            <td valign="top" width="*" class="invisible"></td>
        </tr>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">OBX.2.ValueType</th>
            <td valign="top" width="*" class="invisible">'ST'</td>
            <td valign="top" width="*" class="invisible"></td>
        </tr>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">OBX.3.ObservationIdentifier</th>
            <td valign="top" width="*" class="invisible">Primary and secondary identifiers 
            from the MedicalDeviceInput node message, and a short description of the measurement 
            type.</td>
            <td valign="top" width="*" class="invisible"></td>
        </tr>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">OBX.5.ObservationValue</th>
            <td valign="top" width="*" class="invisible">Value from the MedicalDeviceInput node 
            message.</td>
            <td valign="top" width="*" class="invisible"></td>
        </tr>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">OBX.6.Units</th>
            <td valign="top" width="*" class="invisible">Units from the MedicalDeviceInput node 
            message.</td>
            <td valign="top" width="*" class="invisible"></td>
        </tr>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">OBX.11.ObservationResultStatus</th>
            <td valign="top" width="*" class="invisible">'F'</td>
            <td valign="top" width="*" class="invisible"></td>
        </tr>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">OBX.14.DateTimeoftheObservation</th>
            <td valign="top" width="*" class="invisible">Same as
                <span class="msobjprop">
                MSH.7.DateTimeOfMessage
                </span>
            </td>
            <td valign="top" width="*" class="invisible"></td>
        </tr>
        </tbody>
    </table>
    <p>
    The pattern creates multiple OBX segments for waveform messages as they can 
    contain multiple measurements.
    </p>
</div>
<div class="section">
    <a name="output"></a><h2>Output from a pattern instance</h2>
    <p>
    In addition to the HL7 messages routed to the destination application, this 
    pattern provides a number of other outputs. These outputs are either written to 
    a queue or sent to a Publication node. The destination is determined by the 
    pattern parameter
    <span class="msobjprop">
    Publish
    </span>
    . If the
    <span class="msobjpropval">
    Publish
    </span>
    option is selected, all information is published by using a topic hierarchy that 
    begins with the pattern instance name.
    </p>
    <p>
    If the
    <span class="msobjpropval">
    Write to queue
    </span>
    option is selected, output is sent to queues with names that are generated from 
    the pattern parameter
    <span class="msobjprop">
    Queue prefix
    </span>
    and a fixed set of suffixes, as shown in the following table.
    </p>
    <p>
    <b>Note</b>: The initial facet of each topic (the pattern instance name) is not 
    shown.
    </p>
</div>
<div class="tablenoborder">
    <table summary="" width="100%" border="1" cellpadding="4" cellspacing="0" frame="border" rules="all">
        <thead align="left">
        <tr>
            <th class="firstcol" align="left" valign="top" width="20%">Output</th>
            <th class="invisible" valign="top" width="15%">Queue Suffix</th>
            <th class="invisible" valign="top" width="15%">Topic</th>
            <th valign="top" width="50%">Notes</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">Journal</th>
            <td valign="top" width="*" class="invisible">.JRNL</td>
            <td valign="top" width="*" class="invisible">/Journal</td>
            <td valign="top" width="*" class="invisible">This output provides a journal of 
            incoming messages in standard pattern format.
                <p>
                See Note 1.
                </p>
            </td>
        </tr>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">To Transform and Route</th>
            <td valign="top" width="*" class="invisible">.RXF</td>
            <td valign="top" width="*" class="invisible">Not applicable</td>
            <td valign="top" width="*" class="invisible">Each message is sent to the 
            Transform and Route flow. </td>
        </tr>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">Messages in Error</th>
            <td valign="top" width="*" class="invisible">.ERR</td>
            <td valign="top" width="*" class="invisible">Not applicable</td>
            <td valign="top" width="*" class="invisible">Messages that cannot be correctly 
            processed are written to the error queue with error information in an MQRFH2 
            header.</td>
        </tr>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">Canonical</th>
            <td valign="top" width="*" class="invisible">.CAN</td>
            <td valign="top" width="*" class="invisible">/Canonical</td>
            <td valign="top" width="*" class="invisible">If the option to output a canonical 
            feed is selected, a canonical HL7 form of the input message is written.</td>
        </tr>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">To Sender</th>
            <td valign="top" width="*" class="invisible">.DEST</td>
            <td valign="top" width="*" class="invisible">Not applicable</td>
            <td valign="top" width="*" class="invisible">Each message is sent to the Sender 
            flow after it has been transformed to HL7. </td>
        </tr>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">Expired Messages</th>
            <td valign="top" width="*" class="invisible">.EXP</td>
            <td valign="top" width="*" class="invisible">Not applicable</td>
            <td valign="top" width="*" class="invisible">Messages that have exceeded the 
            configured expiry time are written to this queue. </td>
        </tr>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">Service Log</th>
            <td valign="top" width="*" class="invisible">.LOG</td>
            <td valign="top" width="*" class="invisible">Not applicable</td>
            <td valign="top" width="*" class="invisible">Stores a copy of all SOAP request 
            and response messages for the patient identifiers web service.</td>
        </tr>
        <tr>
            <th align="left" valign="top" width="*" class="firstcol">No Matching Patient 
            Identifier</th>
            <td valign="top" width="*" class="invisible">.NOMATCH</td>
            <td valign="top" width="*" class="invisible">Not applicable</td>
            <td valign="top" width="*" class="invisible">Messages that have no matching 
            patient identifier are written to this queue. </td>
        </tr>
        </tbody>
    </table>
    <p>
    <b>Note 1:</b> A journal message is produced from a source message by adding 
    MQMD and MQRFH2 headers. The MQRFH2 header includes:
    </p>
    <ul>
        <li>
            Integration node name
        </li>
        <li>
            Message flow
        </li>
        <li>
            Current time stamp
        </li>
    </ul>
</div>
<p>
</p>
<a href="overview.htm#anchorBack" title="Back">Back to the Healthcare: Medical 
devices to EMR pattern specification</a>
<p>
</p>
</body>
</html>
