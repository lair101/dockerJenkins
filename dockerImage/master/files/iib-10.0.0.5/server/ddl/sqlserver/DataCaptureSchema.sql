-- This script should be run as as follows
-- sqlcmd -d <dbname> -i DataCaptureSchema.sql

create table WMB_MSGS
 (
 WMB_MSGKEY VARCHAR(100) NOT NULL, 
 HAS_BITSTREAM CHARACTER(1),
 HAS_EXCEPTION CHARACTER(1),
 HAS_USERDATA CHARACTER(1),
 EVENT_TYPE VARCHAR(100),
 EVENT_NAME VARCHAR(100),
 EVENT_SRCADDR VARCHAR(100),
 BROKER_NAME VARCHAR(100),
 BROKER_UUID VARCHAR(100),
 EXGRP_NAME VARCHAR(100),
 EXGRP_UUID VARCHAR(100),
 MSGFLOW_NAME VARCHAR(100),
 MSGFLOW_UUID VARCHAR(100),
 APPL_NAME VARCHAR(100),
 APPL_UUID VARCHAR(100),
 LIBRARY_NAME VARCHAR(100),
 LIBRARY_UUID VARCHAR(100),
 NODE_NAME VARCHAR(100),
 NODE_TYPE VARCHAR(100),
 DETAIL VARCHAR(100),
 TERMINAL_NAME VARCHAR(100),
 KEY_FLD_1_NM VARCHAR(100),
 KEY_FLD_2_NM VARCHAR(100),
 KEY_FLD_3_NM VARCHAR(100),
 KEY_FLD_4_NM VARCHAR(100),
 KEY_FLD_5_NM VARCHAR(100),
 EVENT_TIMESTAMP VARCHAR(100),
 LOCAL_TRANSACTION_ID VARCHAR(100),
 PARENT_TRANSACTION_ID VARCHAR(100),
 GLOBAL_TRANSACTION_ID VARCHAR(100),
 primary key(WMB_MSGKEY)
 )
GO

create table WMB_EVENT_TYPES
 ( 
 EVENT_TYPE_ID INTEGER NOT NULL, 
 EVENT_NAME VARCHAR(100), 
 EVENT_DESCRIPTION  VARCHAR(100),
 primary key(EVENT_TYPE_ID)
 )
GO

create table WMB_EVENT_FIELDS
 ( 
 EVENT_TYPE_ID INTEGER NOT NULL, 
 KEY_FLD_ID INTEGER NOT NULL, 
 KEY_FLD_NAME VARCHAR(100), 
 KEY_FLD_DESC VARCHAR(100), 
 KEY_FLD_PATH VARCHAR(200),
 primary key(EVENT_TYPE_ID)
 )
GO

create table WMB_BINARY_DATA 
 ( 
 WMB_MSGKEY VARCHAR(100) NOT NULL, 
 DATA_TYPE INTEGER NOT NULL, 
 ENCODING VARCHAR(50) NOT NULL, 
 DATA VARCHAR(MAX),
 primary key(WMB_MSGKEY,DATA_TYPE)
 )
GO

-- If you require specific permissions, edit the below
grant all on WMB_MSGS to public
grant all on WMB_EVENT_TYPES to public
grant all on WMB_EVENT_FIELDS to public
grant all on WMB_BINARY_DATA to public
GO

-- Create default indexes
CREATE INDEX WMB_MSGS_TIMESTAMPINDEX       ON WMB_MSGS (EVENT_TIMESTAMP)
CREATE INDEX WMB_MSGS_LOCAL_TRAN_ID_INDEX  ON WMB_MSGS (LOCAL_TRANSACTION_ID)
CREATE INDEX WMB_MSGS_PARENT_TRAN_ID_INDEX ON WMB_MSGS (PARENT_TRANSACTION_ID)
CREATE INDEX WMB_MSGS_GLOBAL_TRAN_ID_INDEX ON WMB_MSGS (GLOBAL_TRANSACTION_ID)
GO
